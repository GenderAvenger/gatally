<!DOCTYPE html>
<html lang="en">
  <!-- Head -->
  {% include "shared/header.html" %}
  <body class="ballotmania">
    <div class="container">
      <div class="row">
        <div class="col-sm-offset-3 col-sm-6 text-center">
          <div id="logo">
            <a href="/"><img src="../img/ballotmania.png" alt="BallotMANia"/></a>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-xs-offset-1 col-xs-10 col-sm-offset-3 col-sm-6 text-center">
          <h2>Count your candidates.</h2>
        </div>
      </div>
      <form method="post" id="zip-form" action="/ballotmania/ballot">
        {% for candidate in candidates %}
          <div class="row">
            <div class="col-xs-offset-1 col-xs-10 text-center">
              <label>{{ candidate }}</label>
            </div>
            <div class="col-xs-offset-2 col-xs-8 col-sm-offset-3 col-sm-6 text-center">
              <div class="row">
                <div class="col-xs-offset-2 col-xs-8 col-sm-offset-0 col-sm-4">
                  <div class="button ballot-button man-button" id="man-{{loop.index}}">Man</div>
                </div>
                <div class="col-xs-offset-2 col-xs-8 col-sm-offset-0 col-sm-4">
                  <div class="button ballot-button woman-button" id="woman-{{loop.index}}">Woman</div>
                </div>
                <div class="col-xs-offset-2 col-xs-8 col-sm-offset-0 col-sm-4">
                  <div class="button ballot-button nonbinary-button" id="nonbinary-{{loop.index}}">Nonbinary</div>
                </div>
              </div>
            </div>
            <div class="col-xs-offset-2 col-xs-8 col-sm-offset-0 col-sm-1 text-center">
            </div>
            <div class="col-xs-offset-2 col-xs-8 col-sm-offset-0 col-sm-1 text-center">
            </div>
          </div>
        {% endfor %}
        {% if noCandidates %}
          <div class="row">
            <div class="col-xs-offset-1 col-xs-10 col-sm-offset-3 col-sm-6 text-center">
              <br />
              <p>There are no candidates in Ballotpedia's database for the specified zip code.</p>
              <br />
            </div>
          </div>
          <div class="row">
            <div class="col-xs-12 text-center">
              <a href="/ballotmania"><div class="btn btn-default btn-lg">Back</div></a>
            </div>
          </div>
        {% else %}
          <div class="row"><br/>
            <div class="col-xs-offset-1 col-xs-5 col-sm-offset-3 col-sm-3 text-right">
              <a href="/ballotmania"><div class="btn btn-default btn-lg">Back</div></a>
            </div>
            <div class="col-xs-5 col-sm-3 text-left">
              <input type="hidden" name="men" value="0" id="men" />
              <input type="hidden" name="women" value="0" id="women" />
              <input type="hidden" name="nonbinary" value="0" id="nonbinary" />
              <input class="btn btn-default btn-lg" type="submit" value="Submit"/>
            </div>
          </div>
        {% endif %}
      </form>
    </div>
    <script type="text/javascript">

      function resetButtonsByIndex(index) {
        $("#man-" + index).removeClass("pressed");
        $("#woman-" + index).removeClass("pressed");
        $("#nonbinary-" + index).removeClass("pressed");
      }

      function activateButton($button) {
        $button.addClass("pressed");
      }

      function setCounts(selections) {
        var manCount = selections.reduce(function(total, selection) {
          if (selection === "m")
            return total + 1;
          return total;
        }, 0)
        var womanCount = selections.reduce(function(total, selection) {
          if (selection === "w")
            return total + 1;
          return total;
        }, 0)
        var nonbinaryCount = selections.reduce(function(total, selection) {
          if (selection === "n")
            return total + 1;
          return total;
        }, 0)

        $("#men").val(manCount);
        $("#women").val(womanCount);
        $("#nonbinary").val(nonbinaryCount);
      }

      $(function() {
        var manButtons = $(".man-button");
        var womanButtons = $(".woman-button");
        var nonbinaryButtons = $(".nonbinary-button");
        var selections = [];

        manButtons.click(function() {
          var $this = $(this);
          var id = $this.attr("id");
          var index = parseInt(id.slice(4), 10);
          resetButtonsByIndex(index);
          activateButton($this);
          selections[index] = 'm';
          setCounts(selections);
        })
        womanButtons.click(function() {
          var $this = $(this);
          var id = $this.attr("id");
          var index = parseInt(id.slice(6), 10);
          resetButtonsByIndex(index);
          activateButton($this);
          selections[index] = 'w';
          setCounts(selections);
        })
        nonbinaryButtons.click(function() {
          var $this = $(this);
          var id = $this.attr("id");
          var index = parseInt(id.slice(10), 10);
          resetButtonsByIndex(index);
          activateButton($this);
          selections[index] = 'n';
          setCounts(selections);
        })
      });
    </script>
    {% include "shared/footer.html" %}
  </body>
</html>
